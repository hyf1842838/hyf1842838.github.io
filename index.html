<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  

  
  
  <meta name="google-site-verification" content="NCXVSqxqB-os803-VFMtIEd1SUNJVOIjctCfNYUwD0w">
  <meta name="baidu-site-verification" content="Nzwx7HuplM">
  
  <meta name="msvalidate.01" content="9E9EA92F7E5327E1FE8A5196D5253664">
  
  
  
  <title>玄武岩</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="玄武岩">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="玄武岩">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="玄武岩">
  
  
    <link rel="icon" href="http://7u2hdm.com1.z0.glb.clouddn.com/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push -->
  <script src="//push.zhanzhang.baidu.com/push.js"></script>
</head></html>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="玄武岩" rel="home">玄武岩</a>
      </h1>
      
        <script type="text/javascript" src="http://api.hitokoto.us/rand?encode=js&charset=utf-8"></script>
        <h2 class="site-description"><script>hitokoto();</script></h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="http://it-ebooks.flygon.net/">电子书</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/makes">MAKES</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/about">关于我</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/atom.xml">RSS</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://github.com/hyf1842838/blog">fork me on github</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-模型设计" class="post-模型设计 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/04/模型设计/">模型设计</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/04/模型设计/" data-id="cjqj8h4y30003bwurmi8biy4i" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="1模型设计部分参数"><a href="#1模型设计部分参数" class="headerlink" title="1模型设计部分参数"></a>1模型设计部分参数</h2><h3 id="1-1迁移表中db-table"><a href="#1-1迁移表中db-table" class="headerlink" title="1.1迁移表中db_table"></a>1.1迁移表中db_table</h3><p>指定db_table参数，表示模型迁移时，映射到数据库中的表名称<br>如果没指定db_table参数，则数据库中模型映射的表名为：应用名(app)_模型名</p>
<h3 id="1-2模型中的外键约束中的on-delete参数"><a href="#1-2模型中的外键约束中的on-delete参数" class="headerlink" title="1.2模型中的外键约束中的on_delete参数"></a>1.2模型中的外键约束中的on_delete参数</h3><p>on_delete=models.CASCADE:不能删除主表，从表相应数据可以被删除（默认）<br>on_delete=models.PROTECT：不让删主表，但可以删从表<br>on_delete=models.SET_NULL：删除主表，从表的关联字段(外键)设置为空</p>
<h3 id="1-3模型中外键约束中的related-name参数"><a href="#1-3模型中外键约束中的related-name参数" class="headerlink" title="1.3模型中外键约束中的related_name参数"></a>1.3模型中外键约束中的related_name参数</h3><p>related_name:关联对象反向引用描述符<br>related_name=’info’：给反向引用描述符命名为info；如果不设置，则默认为模型名的全小写</p>
<h2 id="2模型设计部分字段类型"><a href="#2模型设计部分字段类型" class="headerlink" title="2模型设计部分字段类型"></a>2模型设计部分字段类型</h2><p>CharField:字符串类型<br>TextField：存储长文本内容，前端的areatext标签<br>IntegerField:整型<br>ImageField:字符串类型，用于存图片<br>BooleanField:布尔，True或者False<br>DateTimeField:日期，年月日时分秒<br>DateField：年月日<br>FloatField：浮点类型</p>
<p>DecimalField：浮点类型，限制最大长度和小数点后的长度<br>unique：是否唯一<br>default：默认值<br>null：是否可以为空</p>
<p>primary_key：主键（电脑可以自己赋值）<br>auto_now_add:创建时，默认赋值为当前时间<br>auto_now：在创建或者修改时，默认赋值为当前时间（更新时只能用save方法更新）<br>max_length:最大长度</p>
<h2 id="3一对一模型中给从表添加对象"><a href="#3一对一模型中给从表添加对象" class="headerlink" title="3一对一模型中给从表添加对象"></a>3一对一模型中给从表添加对象</h2><p>一对一（OneToOneField），常写作（1：1），定义在模型中的任何一方都可以<br>存储：<br>    关联字段存储1：stu_info.关联字段=关联对象<br>        stu_info.stu=Student.objects.get(id=1)<br>    关联字段存储2: stu_info.关联字段_id=主键id值<br>        stu_info.stu_id=1<br>查询：<br>    学生对象查拓展表对象：学生对象.拓展模型名称的小写<br>    拓展表查询学生对象：拓展表对象.外键约束字段<br>学生与其紧急联系人之间为一对一模型关系<br>先在models中创建StudentInfo模型</p>
<pre><code>class StudentInfo(models.Model):
    s_no = models.CharField(max_length=10,null=False)
    phone = models.CharField(max_length=11,null=True)
    name = models.CharField(max_length=10,null=True)
    设置stu字段并为其设置为1对1属性
    stu = models.OneToOneField(Student,on_delete=models.SET_NULL,
                           related_name=&apos;info&apos;,null=True)
</code></pre><p>在对从表添加数据并为其主键赋值时，有两种写法<br>stu_info（从表对象）.stu（从表字段）=Student.objects.get(id=1)（主表具体的对象）<br>stu_info.stu_id（外键）=1（主表对应的主键）；功能都是相同的。</p>
<h3 id="3-1对外键赋值方法一"><a href="#3-1对外键赋值方法一" class="headerlink" title="3.1对外键赋值方法一"></a>3.1对外键赋值方法一</h3><pre><code>def add_stu_info(request):
    stu_info = StudentInfo()
    stu_info.s_no=&apos;12556&apos;
    stu_info.phone=&apos;13981366521&apos;
    stu_info.name=&apos;小王&apos;
    stu_info.stu=Student.objects.get(id=1)
    stu_info.save()
    return HttpResponse(&apos;创建拓展信息成功&apos;)
</code></pre><h3 id="3-2对外键赋值方法二"><a href="#3-2对外键赋值方法二" class="headerlink" title="3.2对外键赋值方法二"></a>3.2对外键赋值方法二</h3><pre><code>def add_stu_info(request):
    stu_info = StudentInfo()
    stu_info.s_no=&apos;12556&apos;
    stu_info.phone=&apos;13981366521&apos;
    stu_info.name=&apos;小王&apos;
    stu_info.stu_id=1
    stu_info.save()
    return HttpResponse(&apos;创建拓展信息成功&apos;)
</code></pre><h2 id="4一对一模型中通过主表查询从表（不用related-name参数）"><a href="#4一对一模型中通过主表查询从表（不用related-name参数）" class="headerlink" title="4一对一模型中通过主表查询从表（不用related_name参数）"></a>4一对一模型中通过主表查询从表（不用related_name参数）</h2><p>过程：<br>1.查询主表（学生）对象<br>2.通过主表（学生）对象查询从表（拓展表）对象<br>在主表查从表获取连表条件时有两种写法：<br>stu_info=StudentInfo.objects.filter(stu（从表字段）=stu（主表对象）).first()<br>stu_info=StudentInfo.objects.filter(stu_id（从表字段）=stu.id（主表对象的属性）).first()</p>
<h3 id="4-1查询方法1"><a href="#4-1查询方法1" class="headerlink" title="4.1查询方法1"></a>4.1查询方法1</h3><pre><code>def sel_phone_by_stu(request):
    stu=Student.objects.filter(s_name=&apos;小明&apos;).first()
    stu_info=StudentInfo.objects.filter(stu=stu).first()
    phone=stu_info.phone
    return HttpResponse(&apos;查询电话成功&apos;)
</code></pre><h3 id="4-2查询方法2"><a href="#4-2查询方法2" class="headerlink" title="4.2查询方法2"></a>4.2查询方法2</h3><pre><code>def sel_phone_by_stu(request):
    stu=Student.objects.filter(s_name=&apos;小明&apos;).first()
    stu_info=StudentInfo.objects.filter(stu_id=stu.id).first()
    phone=stu_info.phone
    return HttpResponse(&apos;查询电话成功&apos;)
</code></pre><h2 id="5一对一模型中通过主表查询从表（用related-name参数）"><a href="#5一对一模型中通过主表查询从表（用related-name参数）" class="headerlink" title="5一对一模型中通过主表查询从表（用related_name参数）"></a>5一对一模型中通过主表查询从表（用related_name参数）</h2><p>反向引用过程：<br>1.查询学生对象<br>2.反向查询；关联模型对象，关联另外一个模型的名称的小写</p>
<h3 id="5-1使用模型中默认的related-name参数"><a href="#5-1使用模型中默认的related-name参数" class="headerlink" title="5.1使用模型中默认的related_name参数"></a>5.1使用模型中默认的related_name参数</h3><p>模型中默认的related_name参数为模型名的全小写</p>
<pre><code>def sel_phone_by_stu2(request):
    stu=Student.objects.filter(s_name=&apos;小明&apos;).first()
    stu_info = stu.studentinfo #studentinfo反向引用符
    phone=stu_info.phone
    print(phone)
    return HttpResponse(&apos;查询电话成功&apos;)
</code></pre><h3 id="5-2使用设置的related-name参数"><a href="#5-2使用设置的related-name参数" class="headerlink" title="5.2使用设置的related_name参数"></a>5.2使用设置的related_name参数</h3><p>在模型中的主键中设置：stu = models.OneToOneField(Student,on_delete=models.SET_NULL,<br> related_name=’info’,null=True)；将related_name设置为info</p>
<pre><code>def sel_phone_by_stu2(request):
    stu=Student.objects.filter(s_name=&apos;小明&apos;).first()
    stu_info = stu.info #info反向引用符
    phone=stu_info.phone
    print(phone)
    return HttpResponse(&apos;查询电话成功&apos;)
</code></pre><h2 id="6一对一模型中通过从表查询主表"><a href="#6一对一模型中通过从表查询主表" class="headerlink" title="6一对一模型中通过从表查询主表"></a>6一对一模型中通过从表查询主表</h2><p>1.查询拓展表信息<br>2.查询学生对象</p>
<pre><code>def sel_stu_by_info(request):
    stu_info=StudentInfo.objects.filter(s_no=&apos;12556&apos;).first()
    stu（学生对象）=stu_info（拓展对象）.stu（拓展表字段）
    print(stu.s_name)
    return HttpResponse(&apos;查询成功&apos;)
</code></pre><h2 id="7一对一模型中删除信息"><a href="#7一对一模型中删除信息" class="headerlink" title="7一对一模型中删除信息"></a>7一对一模型中删除信息</h2><p>当模型中为关联字段设置on_delete时，各参数的意义；<br>stu = models.OneToOneField(Student,on_delete=models.SET_NULL）<br>on_delete=models.CASCADE:不能删除主表，从表相应数据可以被删除（默认）<br>on_delete=models.PROTECT：不让删主表，但可以删从表<br>on_delete=models.SET_NULL：删除主表，从表的关联字段(外键)设置为空</p>
<pre><code>def on_delete_stu(request):
    Student.objects.filter(s_name=&apos;小明&apos;).delete()
    return HttpResponse(&apos;删除成功&apos;)
</code></pre><h2 id="8一对多模型中创建班级"><a href="#8一对多模型中创建班级" class="headerlink" title="8一对多模型中创建班级"></a>8一对多模型中创建班级</h2><p>一对多（ForeignKey），常写作（1：N），定义在多的一方<br>存储（给学生设置班级）：<br>    关联字段的存储1：学生对象.关系字段=关联模型对象<br>    关联字段的存储2：学生对象.关系字段_id=关联表的主键id值<br>查询：<br>若没有定义related_name参数：<br>    学生查询班级：班级对象=多的一方（学生）对象.关联字段<br>    班级查询学生：一的一方（班级）.关联模型名的小写_s<br>若定义了related_name参数：<br>    学生查班级：多的一方（学生）对象.关联字段<br>    班级查询学生：一的一方（班级）.related_name参数名<br>先创建一个班级模型；班级与学生之间为一对多模型</p>
<pre><code>class Grade(models.Model):
    g_name=models.CharField(max_length=10,unique=True)
    class Meta:
        db_table=&apos;grade&apos;

def add_grade(request):
    Grade.objects.create(g_name=&apos;java1807&apos;)
    return HttpResponse(&apos;添加班级成功&apos;)
</code></pre><h2 id="9给学生设置班级"><a href="#9给学生设置班级" class="headerlink" title="9给学生设置班级"></a>9给学生设置班级</h2><pre><code>def stu_grade(request):
    stu=Student.objects.get(pk=4)
    stu.g_id=1 #给该对象的g_id属性（班级）赋值为1
    stu.save()
    return HttpResponse(&apos;分配学生班级成功&apos;)
</code></pre><h2 id="10通过学生查询班级"><a href="#10通过学生查询班级" class="headerlink" title="10通过学生查询班级"></a>10通过学生查询班级</h2><pre><code>def sel_grade_by_stu(request):
    # 获取姓名叫小明2的学生对象
    stu=Student.objects.get(s_name=&apos;小明2&apos;)
    # 获取班级对象
    grade=stu.g
    print(grade.g_name)
    return HttpResponse(&apos;查询成功&apos;)
</code></pre><h2 id="11通过班级查询学生"><a href="#11通过班级查询学生" class="headerlink" title="11通过班级查询学生"></a>11通过班级查询学生</h2><pre><code>def sel_stu_by_grade(request):
    grade=Grade.objects.get(g_name=&apos;python1808&apos;)
    stus=grade.student_set.all()
    print(stus)#返回含有对象的列表
    stus=grade.student_set
    print(stus)#返回app.Student.None
    return HttpResponse(&apos;查询成功&apos;)
</code></pre><h2 id="12多对多模型中创建课程"><a href="#12多对多模型中创建课程" class="headerlink" title="12多对多模型中创建课程"></a>12多对多模型中创建课程</h2><p>多对多（ManyToManyField），常写作（N：M），可以定义在模型中的任何一方<br>多对多的存储同一对多一样；<br>1.在查询方面如果没有设置related_name参数；<br>    当用课程查询学生时，查询方式为：课程对象.关联字段.filter（）<br>    用学生查询课程时，查询方式为：学生对象.关联模型名的小写_set<br>2.如果设置了related_name参数：<br>    用课程查询学生:课程对象.关联字段.filter().all()<br>    用学生查询课程:学生对象.related_name参数.filter().all()<br>创建一个课程表，课程与学生之间为多对多关系</p>
<pre><code>class Course(models.Model):
    c_name=models.CharField(max_length=10,unique=True)
    # ManyToManyField字段定义在任何一个模型都可以
    stu=models.ManyToManyField(Student,null=True)
    class Meta:
        db_table=&apos;course&apos;
</code></pre><p>往课程表中添加课程</p>
<pre><code>def add_course(request):
    c_names=[&apos;大学英语&apos;,&apos;高等数学&apos;,&apos;岩浆岩岩石学&apos;,
         &apos;线性代数&apos;,&apos;概率论&apos;,&apos;运筹学&apos;]
    for name in c_names:
        cou = Course()
        cou.c_name=name
        cou.save()
    return HttpResponse(&apos;添加课程成功&apos;)
</code></pre><h2 id="13通过中间表添加删除学生或者课程"><a href="#13通过中间表添加删除学生或者课程" class="headerlink" title="13通过中间表添加删除学生或者课程"></a>13通过中间表添加删除学生或者课程</h2><h3 id="13-1给学生添加课程"><a href="#13-1给学生添加课程" class="headerlink" title="13.1给学生添加课程"></a>13.1给学生添加课程</h3><pre><code>def add_s_c(request):
    cou=Course.objects.get(c_name=&apos;高等数学&apos;)
    stu=Student.objects.get(s_name=&apos;妲己&apos;)
    stu.course_set.add(cou)
    return HttpResponse(&apos;添加中间表成功&apos;)
</code></pre><h3 id="13-2给课程添加学生"><a href="#13-2给课程添加学生" class="headerlink" title="13.2给课程添加学生"></a>13.2给课程添加学生</h3><pre><code>def add_s_c(request):
    cou=Course.objects.get(c_name=&apos;高等数学&apos;)
    stu=Student.objects.get(s_name=&apos;妲己&apos;)
    cou.stu(学生模型中反向引用符).add(stu(学生对象))
    return HttpResponse(&apos;添加中间表成功&apos;)
</code></pre><h3 id="13-3学生删除课程"><a href="#13-3学生删除课程" class="headerlink" title="13.3学生删除课程"></a>13.3学生删除课程</h3><pre><code>def add_s_c(request):
    cou=Course.objects.get(c_name=&apos;高等数学&apos;)
    stu=Student.objects.get(s_name=&apos;妲己&apos;)
    stu.course_set.remove(cou)
    return HttpResponse(&apos;添加中间表成功&apos;)
</code></pre><h2 id="14前端设计"><a href="#14前端设计" class="headerlink" title="14前端设计"></a>14前端设计</h2><h3 id="14-1配置"><a href="#14-1配置" class="headerlink" title="14.1配置"></a>14.1配置</h3><p>在settings.py文件中定义TEMPALTES的目录地址第58行添加如下文字：’DIRS’: [os.path.join(BASE_DIR,’templates’)],<br>os.path.join(BASE_DIR,’templates’)中BASE_DIR表示第16行的BASE_DIR获取到的文件位置，templates表示含有网页文件的文件夹；os.path.join（’a’,’b’）表示文件路径：a//b</p>
<h3 id="14-2后端渲染模板"><a href="#14-2后端渲染模板" class="headerlink" title="14.2后端渲染模板"></a>14.2后端渲染模板</h3><p>使用render()渲染模板<br>传递参数给模板,render(request,模板名,{key1:value1,key2:value2})</p>
<pre><code>from django.shortcuts import render
def index(request):
    stus=Student.objects.all()
    return render(request,&apos;index.html&apos;,{&apos;a&apos;:stus})
</code></pre><h3 id="14-3前端渲染模板"><a href="#14-3前端渲染模板" class="headerlink" title="14.3前端渲染模板"></a>14.3前端渲染模板</h3><p>1.解析变量：<br>2.解析标签：{\% 标签 %}{\% endfor标签 %}</p>
<pre><code>{{ a }} #解析变量
&lt;br&gt; #换行标签
{% for stu in a %} #for标签
        <p>姓名：{{ stu.s_name }}
            年龄：{{ stu.s_age }}
            班级：{{ stu.g.g_name }}
            选课：
            {% for c in stu.course_set.all %}
                {{ c.c_name }}
                {% endfor %}
    &lt;/p&gt;
{% endfor %} #结束标签
</p></code></pre><h2 id="15总结"><a href="#15总结" class="headerlink" title="15总结"></a>15总结</h2><h3 id="15-1聚合函数及模糊查询"><a href="#15-1聚合函数及模糊查询" class="headerlink" title="15.1聚合函数及模糊查询"></a>15.1聚合函数及模糊查询</h3><p>聚合函数(Avg,Max,Sum,Count)的使用<br>模型名.objects.筛选条件.aggregate(聚合函数(‘聚合条件’))<br>模糊查询（contains、startswith及endswith）<br>模型名.objects.filter(查询字段__startswith=’查询内容’)</p>
<h3 id="15-2related-name参数"><a href="#15-2related-name参数" class="headerlink" title="15.2related_name参数"></a>15.2related_name参数</h3><p>模型中外键约束中的related_name参数：<br>related_name:关联对象反向引用描述符；当为一对一关系时，related_name参数默认为对应模型的模型名全小写；当为一对多或者多对多关系时，默认为对应模型的模型名小写_set</p>
<h3 id="15-3用主表给从表关联字段赋值"><a href="#15-3用主表给从表关联字段赋值" class="headerlink" title="15.3用主表给从表关联字段赋值"></a>15.3用主表给从表关联字段赋值</h3><p>当用主表中的信息(主键)给从表的关联字段(外键)赋值时：<br>从表对象.关联字段=主表对象(主表对象要唯一) 或者 从表对象.关联字段_id=要赋的主表对象对应的主键具体值</p>
<h3 id="15-4不用related-name用主表查从表"><a href="#15-4不用related-name用主表查从表" class="headerlink" title="15.4不用related_name用主表查从表"></a>15.4不用related_name用主表查从表</h3><p>当不用related_name参数查询时：<br>当用主表查从表时（无关联参数的一方查有关联参数的一方），先生成主表对象；然后从表对象=从表模型名.objects.filter(关联字段=主表对象/关联字段_id=主表对象.id).first()</p>
<h3 id="15-5用related-name查询"><a href="#15-5用related-name查询" class="headerlink" title="15.5用related_name查询"></a>15.5用related_name查询</h3><p>当用related_name参数查询时：<br>当用主表查从表时（无关联参数的一方查有关联参数的一方），需要用related_name参数生成从表对象(从表对象=主表对象.related_name参数/当为一对多关系时，还要在后面接上.all()才是查询集集合)<br>当用从表查主表时（有关联参数的一方查无关联参数的一方），直接用关联字段生成主表对象(主表对象=从表对象.关联字段)</p>
<h3 id="15-6多对多中间表数据的添加与删除"><a href="#15-6多对多中间表数据的添加与删除" class="headerlink" title="15.6多对多中间表数据的添加与删除"></a>15.6多对多中间表数据的添加与删除</h3><p>当为多(M)对多(N)关系时：<br>往中间表中添加数据：M对象.N的related_name参数.add(N对象)<br>在中间表中删除数据：M对象.N的related_name参数.remove(N对象)</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/04/模型设计/">
    <time datetime="2019-01-04T12:32:25.000Z" class="entry-date">
        2019-01-04
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-模型关系映射" class="post-模型关系映射 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/03/模型关系映射/">模型关系映射</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/03/模型关系映射/" data-id="cjqj8h4xt0002bwurhxjwuysd" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>导入函数或者文件方法：先写一个函数名或者其他，然后按alt+enter<br>ctrl+d 快速复制当前行并粘贴到下一行<br>ctrl+y 删除当前行<br>模型层<br> ORM技术:对象关系映射  —objects relationship mapping<br>对象关系映射：将模型中的语句映射为数据库中的语句，可以通过编写模型中的语句对数据库(多种)进行操作<br>objects：管理器，默认模型的属性<br>在orm技术中，pk代表表格的主键（primary key）</p>
<h2 id="1-添加学生对象（create）"><a href="#1-添加学生对象（create）" class="headerlink" title="1 添加学生对象（create）"></a>1 添加学生对象（create）</h2><p>创建 create（）方法：模型名.objects.create(字段1=值，字段2=值)<br>save方法：模型对象.save（）</p>
<h3 id="1-1-create方法"><a href="#1-1-create方法" class="headerlink" title="1.1 create方法"></a>1.1 create方法</h3><pre><code>def add_stu(request):
    Student.objects.create(s_name=&apos;小明&apos;)
    return HttpResponse(&apos;创建学生成功&apos;)
</code></pre><h3 id="1-2-save方法"><a href="#1-2-save方法" class="headerlink" title="1.2 save方法"></a>1.2 save方法</h3><pre><code>def add_stu(request):
    stu = Student()
    stu.s_name = &apos;老王&apos;
    stu.s_gender = 1
    stu.save()
    return HttpResponse(&apos;创建学生成功&apos;)
</code></pre><h2 id="2-删除学生"><a href="#2-删除学生" class="headerlink" title="2 删除学生"></a>2 删除学生</h2><p>删除学生的步骤：<br>1.获取删除的对象，filter(条件)<br> 2.实现删除方法 delete()<br>删除 delete（）方法：模型名.objects.filter(条件).delete()</p>
<pre><code>def del_stu(request):
    Student.objects.filter(id=13).delete()
    return HttpResponse(&apos;删除成功&apos;)
</code></pre><h2 id="3-更新（修改）学生"><a href="#3-更新（修改）学生" class="headerlink" title="3 更新（修改）学生"></a>3 更新（修改）学生</h2><p>更新学生步骤：<br>1.获取更新的数据，filter（条件）<br> 2.实现更新方法， update（）<br>修改 update（）方法：模型名.objects.filter(条件).update(字段1=值，字段2=值)<br>save（）方法：模型对象.save<br>update（）和save（）的区别：是否更新使用auto_now约束条件的字段，（update不更新）</p>
<h3 id="3-1update方法"><a href="#3-1update方法" class="headerlink" title="3.1update方法"></a>3.1update方法</h3><pre><code>def up_stu(request):
    Student.objects.filter(id=4).update(s_name=&apos;妲己&apos;)
    return HttpResponse(&apos;更新成功&apos;)
</code></pre><h3 id="3-2save方法"><a href="#3-2save方法" class="headerlink" title="3.2save方法"></a>3.2save方法</h3><pre><code>def up_stu(request):
    stu = Student.objects.filter(id=2).first()
    stu.s_name = &apos;妲己2&apos;
    stu.save()
    return HttpResponse(&apos;更新成功&apos;)
</code></pre><h2 id="4查询学生"><a href="#4查询学生" class="headerlink" title="4查询学生"></a>4查询学生</h2><h3 id="4-1查询所有学生"><a href="#4-1查询所有学生" class="headerlink" title="4.1查询所有学生"></a>4.1查询所有学生</h3><p>查询所有的学生信息,all()，返回一组对象的列表</p>
<pre><code>def sel_stu(request):
    stus = Student.objects.all()
    for stu in stus:
        print(stu.s_name)
</code></pre><h3 id="4-2查询特定的单个学生"><a href="#4-2查询特定的单个学生" class="headerlink" title="4.2查询特定的单个学生"></a>4.2查询特定的单个学生</h3><h4 id="4-2-1filter方法"><a href="#4-2-1filter方法" class="headerlink" title="4.2.1filter方法"></a>4.2.1filter方法</h4><p>返回的是queryset对象</p>
<pre><code>stu5 = Student.objects.filter(id=6)
print(stu)  # &lt;QuerySet [&lt;Student: Student object (6)&gt;]&gt;
</code></pre><p>first()：取出结果中的第一个对象</p>
<pre><code>stu = Student.objects.filter(id=6).first()
print(stu)  # Student object (6)
</code></pre><h4 id="4-2-2get（）方法"><a href="#4-2-2get（）方法" class="headerlink" title="4.2.2get（）方法"></a>4.2.2get（）方法</h4><p>get（）只能用来取唯一的一个对象<br>get（条件）条件必须成立才能使用</p>
<pre><code>stu = Student.objects.get(id=6)
print(stu)  # Student object (6)（返回id为6的学生对象）
</code></pre><h3 id="4-3查询特定的多个学生"><a href="#4-3查询特定的多个学生" class="headerlink" title="4.3查询特定的多个学生"></a>4.3查询特定的多个学生</h3><pre><code>stus = Student.objects.filter(s_gender=1)
print(stus) #查询所有的男性
</code></pre><h3 id="4-4exclude（条件）方法"><a href="#4-4exclude（条件）方法" class="headerlink" title="4.4exclude（条件）方法"></a>4.4exclude（条件）方法</h3><p>exclude(条件):过滤出不满足条件的信息</p>
<pre><code>stus = Student.objects.exclude(s_gender=0)
print(stus)#查询所有性别为女的之外的性别的人（即查询全部男性）
</code></pre><h3 id="4-5order-by-排序方法"><a href="#4-5order-by-排序方法" class="headerlink" title="4.5order_by()排序方法"></a>4.5order_by()排序方法</h3><p>order_by（’id’）,升序<br>order_by（’-id’）,降序</p>
<pre><code>stus = Student.objects.order_by(&apos;id&apos;)
print(stus)
</code></pre><h3 id="4-6values（）方法"><a href="#4-6values（）方法" class="headerlink" title="4.6values（）方法"></a>4.6values（）方法</h3><p>values（）取出对象中的某个字段-返回的是一个列表，列表中为字典</p>
<pre><code>stus = Student.objects.all().values(&apos;s_name&apos;, &apos;s_age&apos;) #取所有人的姓名和年龄
stus1 = Student.objects.all().values() #取所有人的所有信息
print(stus, stus1)
</code></pre><h3 id="4-7exists-方法、len-方法及count-方法"><a href="#4-7exists-方法、len-方法及count-方法" class="headerlink" title="4.7exists()方法、len()方法及count()方法"></a>4.7exists()方法、len()方法及count()方法</h3><p>exists()方法 - 判断查询信息存在否，返回布尔值</p>
<pre><code># 判断小张这个人存在不
a = Student.objects.filter(s_name=&apos;小张&apos;).exists()
print(a)  # False

stus = Student.objects.filter(s_gender=1)
# len查看查询结果的长度
print(len(stus))  # 2

# count统计查询结果元素的个数
b = Student.objects.filter(s_gender=1).count()
print(b)  # 2
</code></pre><h3 id="4-8模糊查询（contains、startswith及endswith）"><a href="#4-8模糊查询（contains、startswith及endswith）" class="headerlink" title="4.8模糊查询（contains、startswith及endswith）"></a>4.8模糊查询（contains、startswith及endswith）</h3><h4 id="4-8-1contains方法"><a href="#4-8-1contains方法" class="headerlink" title="4.8.1contains方法"></a>4.8.1contains方法</h4><p>contains:包含，模糊查询；语法，字段__contains=</p>
<pre><code>stus = Student.objects.filter(s_name__contains=&apos;小明&apos;)
print(stus)
</code></pre><h4 id="4-8-2startswith方法"><a href="#4-8-2startswith方法" class="headerlink" title="4.8.2startswith方法"></a>4.8.2startswith方法</h4><p>startswith:以什么开头</p>
<pre><code>stus = Student.objects.filter(s_name__startswith=&apos;小&apos;)
print(stus)
</code></pre><h4 id="4-8-3endswith方法"><a href="#4-8-3endswith方法" class="headerlink" title="4.8.3endswith方法"></a>4.8.3endswith方法</h4><p>endswith:以什么结束</p>
<pre><code>stus = Student.objects.filter(s_name__endswith=&apos;明&apos;)
print(stus)
</code></pre><h3 id="4-9in方法"><a href="#4-9in方法" class="headerlink" title="4.9in方法"></a>4.9in方法</h3><p>in：查询在某个范围之内</p>
<pre><code>stus = Student.objects.filter(id__in=[1, 2, 3, 4, 5])
print(stus)

stus = Student.objects.filter(pk__in=[1, 2, 3, 4, 5])
print(stus)
</code></pre><p>pk代表主键，而id是这个学生表的主键，所以结果将一样</p>
<h3 id="4-10大于及小于符号"><a href="#4-10大于及小于符号" class="headerlink" title="4.10大于及小于符号"></a>4.10大于及小于符号</h3><p>gte:大于等于；gt：大于；lte：小于等于；lt：小于<br>在比较符号后面必须是一个值</p>
<pre><code>stus = Student.objects.filter(s_age__gte=21, s_age__lte=23)
stus=Student.objects.filter(s_age__gte=21).filter(s_age__lte=23)
</code></pre><p>上面两条语句的结果相同，都为查询年龄大于等于21且小于等于23的人</p>
<h3 id="4-11与或非"><a href="#4-11与或非" class="headerlink" title="4.11与或非"></a>4.11与或非</h3><p>用与或非语句的时候，需要先导入Q方法</p>
<h4 id="4-11-1与"><a href="#4-11-1与" class="headerlink" title="4.11.1与"></a>4.11.1与</h4><pre><code>stus = Student.objects.filter(s_age__gte=21, s_age__lte=23)
stus = Student.objects.filter(Q(s_age__gte=21), Q(s_age__lte=23))
stus = Student.objects.filter(Q(s_age__gte=21) and Q(s_age__lte=23))
stus = Student.objects.filter(Q(s_age__gte=21) &amp; Q(s_age__lte=23))
</code></pre><h4 id="4-11-2或"><a href="#4-11-2或" class="headerlink" title="4.11.2或"></a>4.11.2或</h4><pre><code>stus = Student.objects.filter(Q(s_age__gte=21) or Q(s_age__lte=23))
stus = Student.objects.filter(Q(s_age__gte=21) | Q(s_age__lte=23))
</code></pre><h4 id="4-11-3非"><a href="#4-11-3非" class="headerlink" title="4.11.3非"></a>4.11.3非</h4><pre><code>stus = Student.objects.filter(~Q(s_age__gte=21))
</code></pre><h4 id="4-11-4对象字段比较F（）方法"><a href="#4-11-4对象字段比较F（）方法" class="headerlink" title="4.11.4对象字段比较F（）方法"></a>4.11.4对象字段比较F（）方法</h4><p>查询物理成绩大于数学成绩的学生</p>
<pre><code>stus = Student.objects.all()
for stu in stus:
    if (stu.wuli &gt; stu.math):
        print(stu.s_name)
</code></pre><p>上面方法也能达到要求，但不推荐；推荐使用下面方法<br> F(‘math’):取math对应的值</p>
<pre><code>stus = Student.objects.filter(wuli__gt=F(&apos;math&apos;))
</code></pre><h3 id="4-12聚合函数Avg-Max-Sum-Count"><a href="#4-12聚合函数Avg-Max-Sum-Count" class="headerlink" title="4.12聚合函数Avg,Max,Sum,Count"></a>4.12聚合函数Avg,Max,Sum,Count</h3><pre><code>def sel_stu(request):
    age_avg = Student.objects.all().aggregate(Avg(&apos;s_age&apos;))
    print(age_avg)
    age_sum = Student.objects.all().aggregate(Sum(&apos;s_age&apos;))
    print(age_sum)
    return HttpResponse(&apos;查询所有学生信息&apos;)
</code></pre>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/03/模型关系映射/">
    <time datetime="2019-01-03T12:22:25.000Z" class="entry-date">
        2019-01-03
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-django环境搭建" class="post-django环境搭建 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2019/01/02/django环境搭建/">django环境搭建</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2019/01/02/django环境搭建/" data-id="cjqj8h4t50000bwurae1st4hb" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="1-无图形化界面安装虚拟环境"><a href="#1-无图形化界面安装虚拟环境" class="headerlink" title="1.无图形化界面安装虚拟环境"></a>1.无图形化界面安装虚拟环境</h2><h3 id="1-1安装虚拟器"><a href="#1-1安装虚拟器" class="headerlink" title="1.1安装虚拟器"></a>1.1安装虚拟器</h3><pre><code>pip install virtualenv
</code></pre><h3 id="1-2创建虚拟环境"><a href="#1-2创建虚拟环境" class="headerlink" title="1.2创建虚拟环境"></a>1.2创建虚拟环境</h3><pre><code>virtual --no-site-packages -p D:\python3\python.exe name
</code></pre><p>–no-site-packages：表示创建的虚拟环境为纯净的环境，不安装有其他的库<br>-p D:\python3\python.exe 使用的python版本及其地址（当电脑中只有一个python版本时，此步可省略）<br>name 虚拟库的名字</p>
<h3 id="1-3pip使用"><a href="#1-3pip使用" class="headerlink" title="1.3pip使用"></a>1.3pip使用</h3><pre><code>pip list  查看安装的库
</code></pre><p>pip install xxx 安装xxx的库</p>
<h3 id="1-4激活虚拟环境"><a href="#1-4激活虚拟环境" class="headerlink" title="1.4激活虚拟环境"></a>1.4激活虚拟环境</h3><p>windwos下直接执行activate命令<br>mac/linux/ubuntu:直接执行source activate命令</p>
<pre><code>activate
</code></pre><h3 id="1-5退出虚拟环境"><a href="#1-5退出虚拟环境" class="headerlink" title="1.5退出虚拟环境"></a>1.5退出虚拟环境</h3><p>直接执行deactivate命令</p>
<pre><code>deactivate
</code></pre><h3 id="1-6创建django项目"><a href="#1-6创建django项目" class="headerlink" title="1.6创建django项目"></a>1.6创建django项目</h3><p>1.在虚拟环境中先激活虚拟环境：activate<br>2.在激活环境下进入想要创建到的位置文件夹 cd ../cd<br>3.创建django项目：django-admin startproject day01</p>
<p>启动命令：python manage.py runserver 默认ip为127.0.0.1 默认端口为8000<br>修改启动端口：python manage.py runserver 端口<br>修改ip和端口：python manage.py runserver ip:端口<br>ip参数：如果为0.0.0.0表示任何人都可以通过公网访问django项目<br>端口post参数：如果端口设置为80.表示该端口访问时可以不用写</p>
<h2 id="2django项目各文件的意义"><a href="#2django项目各文件的意义" class="headerlink" title="2django项目各文件的意义"></a>2django项目各文件的意义</h2><h3 id="2-1-manager-py"><a href="#2-1-manager-py" class="headerlink" title="2.1 manager.py"></a>2.1 manager.py</h3><p>manager.py启动文件</p>
<h3 id="2-2-init-py"><a href="#2-2-init-py" class="headerlink" title="2.2__init__.py"></a>2.2__init__.py</h3><p><strong>init</strong>.py包文件:可以通过这个文件将该包下的文件导入其他文件</p>
<h3 id="2-3settings-py-配置文件"><a href="#2-3settings-py-配置文件" class="headerlink" title="2.3settings.py 配置文件"></a>2.3settings.py 配置文件</h3><pre><code>os.path.abspath(__file__)：当前文件的绝对路径
os.path.dirname(os.path.abspath(__file__))：当前文件的上层目录的绝对路径
os.path.dirname(os.path.dirname(os.path.abspath(__file__)))：当前文件的上层的上层的目录的绝对路径（即当前项目的绝对路径）
DEBUG = True：调试模式，上线的时候需要将其改层False
ALLOWED_HOSTS = [&quot;*&quot;]：允许访问的主机的ip地址
ROOT_URLCONF = &apos;day01.urls&apos;：根路由
DATABASES ：数据库配置
    STATIC_URL = &apos;/static/&apos; ：配置html文件路径
</code></pre><h3 id="2-4urls-py路由文件"><a href="#2-4urls-py路由文件" class="headerlink" title="2.4urls.py路由文件"></a>2.4urls.py路由文件</h3><p>将网址写在这个文件中，将能在计算机上对其进行访问</p>
<pre><code>path(&apos;admin/&apos;, admin.site.urls)， 在端口后加/admin访问
path(&apos;hello&apos;,views.hello),加的hello后缀指向views文件下的hello函数
</code></pre><h3 id="2-5wsgi-py"><a href="#2-5wsgi-py" class="headerlink" title="2.5wsgi.py"></a>2.5wsgi.py</h3><p>wsgi.py网关文件</p>
<h2 id="3创建一个app文件"><a href="#3创建一个app文件" class="headerlink" title="3创建一个app文件"></a>3创建一个app文件</h2><pre><code>python manage.py startapp app名称 - 创建一个app文件 
</code></pre><p>在app文件夹中一般都是对models.py和views.py两个文件进行操作，其他文件一般不作改动</p>
<h2 id="4MVT模式和MVC模式区别"><a href="#4MVT模式和MVC模式区别" class="headerlink" title="4MVT模式和MVC模式区别"></a>4MVT模式和MVC模式区别</h2><p>MVC模式是所有框架遵循的模式<br>MVT模式是由MVC模式演变而来的</p>
<h3 id="4-1MVC模式"><a href="#4-1MVC模式" class="headerlink" title="4.1MVC模式"></a>4.1MVC模式</h3><pre><code> M：模型层
V：模板，HTML页面
C：controller，控制器，写业务逻辑的地方
</code></pre><h3 id="4-2MVT模式"><a href="#4-2MVT模式" class="headerlink" title="4.2MVT模式"></a>4.2MVT模式</h3><pre><code>M：models.py，模型层，定义模型和数据库中的表之间的关联关系
V；viems.py，视图层，定义业务逻辑
T；templates，模板，定义页面HTML的地方
</code></pre><p>django框架遵循MVT模式</p>
<h2 id="5配置修改"><a href="#5配置修改" class="headerlink" title="5配置修改"></a>5配置修改</h2><h3 id="5-1修改init-py配置"><a href="#5-1修改init-py配置" class="headerlink" title="5.1修改init.py配置"></a>5.1修改<strong>init</strong>.py配置</h3><pre><code>import pymysql
pymysql.install_as_MySQLdb()
</code></pre><p>因为python3无法直接访问数据库，只有通过pymysql安装MySQLdb()驱动来访问数据库</p>
<h3 id="5-2数据库连接配置"><a href="#5-2数据库连接配置" class="headerlink" title="5.2数据库连接配置"></a>5.2数据库连接配置</h3><pre><code>数据库连接
settings.py中配置
USER参数：访问用户
PASSWORD参数：密码
HOST参数：访问数据库的地址
PORT参数：访问数据库的端口
NAME参数:数据库名（必须是已经存在的数据库）
</code></pre><h3 id="5-3数据迁移"><a href="#5-3数据迁移" class="headerlink" title="5.3数据迁移"></a>5.3数据迁移</h3><h4 id="5-3-1第一次迁移"><a href="#5-3-1第一次迁移" class="headerlink" title="5.3.1第一次迁移"></a>5.3.1第一次迁移</h4><pre><code>python manage.py migrate
</code></pre><h4 id="5-3-2第一次后的迁移"><a href="#5-3-2第一次后的迁移" class="headerlink" title="5.3.2第一次后的迁移"></a>5.3.2第一次后的迁移</h4><pre><code>settings.py第33行INSTALLED_APPS的最后添加需要迁移的文件夹
生成迁移文件：python manage.py makemigrations
执行迁移文件：python manage.py migrate
</code></pre><h2 id="6创建表格"><a href="#6创建表格" class="headerlink" title="6创建表格"></a>6创建表格</h2><p>在app文件夹下的models.py文件中创建</p>
<pre><code>from django.db import models
class Student(models.Model):
    s_name=models.CharField(max_length=10,unique=True)#代表字段是字符串类型
    s_age=models.IntegerField(default=20)#代表字段是整型，默认为20
    s_gender=models.BooleanField(default=0)
    # auto_now_add:创建时，默认字段赋值为最新的时间
    create_time=models.DateTimeField(auto_now_add=True)
    # auto_now:修改数据时，自动赋值为更新字段时的时间
    update_time=models.DateTimeField(auto_now=True)

    class Meta:
        db_table=&apos;student&apos;
</code></pre><p>将app文件添加至settings.py文件的33行后面；<br>然后在命令行中输入迁移指令：python manage.py makemigrations将生成一个迁移文件（0001_initial.py）<br>最后执行迁移指令：python manage.py migrate，新建的表格将被上传至数据库。</p>
<h2 id="7创建超级管理员"><a href="#7创建超级管理员" class="headerlink" title="7创建超级管理员"></a>7创建超级管理员</h2><pre><code>python manage.py createsuperuser
</code></pre>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/01/02/django环境搭建/">
    <time datetime="2019-01-02T11:01:25.000Z" class="entry-date">
        2019-01-02
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-redis数据库主要语法-及与mysql结合用法示例" class="post-redis数据库主要语法-及与mysql结合用法示例 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/12/30/redis数据库主要语法-及与mysql结合用法示例/">redis数据库主要语法-及与mysql结合用法示例</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2018/12/30/redis数据库主要语法-及与mysql结合用法示例/" data-id="cjqj8h4y60004bwurnbg8xvsm" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>redis数据库详细语法及说明见[<a href="http://redisdoc.com/]" target="_blank" rel="noopener">http://redisdoc.com/]</a><br>下面仅对其常见的五种数据类型的语法进行介绍</p>
<h2 id="1字符串"><a href="#1字符串" class="headerlink" title="1字符串"></a>1字符串</h2><p>setex（如果键存在才能设置值）<br>setnx（如果键不存在才能设置值）；<br>mset（一次设置多个键值对）<br>mget（一次获取多个键值对）；<br>incr str1 将str1中存储的数字值增1<br>getset（拿到键之前的值并对其进行新的赋值）<br>gitbit(取指定位上的比特看是否为0)<br>setbit（设置或清除指定偏移量上的比特）<br>setbit ab 128 1设置ab键的第128位为1，其余为0<br>type 键:可以查看键的数据类型<br>object encoding 键 :查看底层的数据类型</p>
<h2 id="2哈希表"><a href="#2哈希表" class="headerlink" title="2哈希表"></a>2哈希表</h2><p>哈希表：字典里面的值又是一个字典，最适合用来保存对象<br>hset stu1 stuid 1001<br>hset stu1 name xiaoming<br>hset stu1 gender male<br>hset stu1 birth 1999-12-31<br>hset stu1 addr chengdu<br>type stu1 # hash<br>object encoding stu1 # ziplist<br>hget stu1 gender # 取一个值<br>hgetall stu1 #取所有<br>hvals stu1 # 取所有的值<br>同时设置多个值<br>hmset stu2 stuid 1002 name wangdachui addr mianyang gender male<br>hmget stu2 name gender #同时获取stu2的两个值<br>hdel stu2 gender #删除stu2的性别(只删除字段)<br>hexists stu2 gender #判断存在否</p>
<p>hset stu1 fav 100<br>hset stu2 fav 95.23<br>hincrby stu1 fav 50 #给学生1增加点赞数50<br>hincrbyfloat stu2 fav 100.234 #给学生2的点赞数增加100.234<br>hkeys stu1 # 取stu1的所有键</p>
<h2 id="3列表"><a href="#3列表" class="headerlink" title="3列表"></a>3列表</h2><p>列表中的数据结构分为栈和队列两种<br>经典数据存储结构：</p>
<h3 id="3-1栈"><a href="#3-1栈" class="headerlink" title="3.1栈"></a>3.1栈</h3><p>栈（stack） - FILO - 先进后出 - lpush + lpop/rpush + rpop<br>lpush list1 100 200 300 400 500 600<br>从左边拿<br>lpop list1 #600<br>。。。<br>lpop list1 #100(先进后出)</p>
<h3 id="3-2队列"><a href="#3-2队列" class="headerlink" title="3.2队列"></a>3.2队列</h3><p>队列（queue） - FIFO - 先进先出- lpush + rpop/rpush + lpop<br>lpush list1 100 200 300 400 500 600<br>从右边拿<br>rpop list1 # 100<br>…<br>rpop list1 # 600（后进后出）</p>
<h3 id="3-3列表基本语法"><a href="#3-3列表基本语法" class="headerlink" title="3.3列表基本语法"></a>3.3列表基本语法</h3><p>lpush list1 100 200 300 400 500 #给列表在左边放了五个数据<br>lrange list1 0 -1 #查看列表下标为0到-1的数据（500 400 …）<br>rpush list2 100 200 300 400 500 #给列表在右边放了五个数据<br>lrange list1 0 -1 #查看列表下标为0到-1的数据（100 200 …）</p>
<p>lpop list1#从列表的左边取一个数据（500）<br>rpop list1 #从列表的右边取一个数据（100）<br>rpop list1 #从列表的右边取一个数据（200）</p>
<p>lpush list1 100 200 300 400<br>lindex list13 取出下标为3的元素（100）<br>llen list1 看列表的长度</p>
<p>lrange list2 0-1 查看list2的两个元素<br>brpop(阻塞式从右边取元素)<br>brpop list2 5  5秒内取list2中的元素，如果超过5秒没有取到东西就返回nil和等待时长</p>
<h2 id="4集合"><a href="#4集合" class="headerlink" title="4集合"></a>4集合</h2><p>set<br>集合中不能放重复元素<br>sadd set1 100 200 100 #创建一个集合<br>smembers set2 #查看集合中的所有元素<br>sinter set1 set2 # 求交集<br>sdiff set1 set2 #求差集<br>sunion set1 set2 # 求并集<br>srem set1 100 #删除100这个元素<br>sismember set1 200 # 查看200是否在集合1中<br>scard set1 #查看集合中元素的个数<br>spop set1 #随机取set1中的一个元素并将其删除<br>srandmember set2 2 随机取随机个数的函数</p>
<h2 id="5有序集合"><a href="#5有序集合" class="headerlink" title="5有序集合"></a>5有序集合</h2><p>zset<br>zadd paihangbang 100 laowang 550 xiaoming 200 sss 500 qqq #创建一个排行榜集合<br>zrange paihangbang 0 -1#将集合的下标0到-1的元素从小到大排序<br>zrevrange paihangbang 0 -1 同上，不过是从大到小排序</p>
<h2 id="6读写分离配置"><a href="#6读写分离配置" class="headerlink" title="6读写分离配置:"></a>6读写分离配置:</h2><p>主机配置：redis-server –requirepass 设置密码 &gt;redis.log 2 &gt; redis-error.log &amp;<br>从机配置: redis-server –slaveof 主机ip 端口–masterauth 主机设置的密码 &gt; redis.log 2&gt;redis -error.log &amp;<br>redis-cli （进入从机）<br>作为从机连接主机<br>slaveof no one #解除主从配置</p>
<p>history：查看历史命令<br>! 历史命令前的id（如! 997）： 将这个命令在执行一遍</p>
<h2 id="7在python中给mysql查询的文件分页"><a href="#7在python中给mysql查询的文件分页" class="headerlink" title="7在python中给mysql查询的文件分页"></a>7在python中给mysql查询的文件分页</h2><pre><code>import pymysql
from pymysql.cursors import DictCursor

con = pymysql.connect(host=&apos;localhost&apos;, port=3306,
                      database=&apos;hrs&apos;, charset=&apos;utf8&apos;,
                      user=&apos;root&apos;, password=&apos;123456&apos;, autocommit=True)
class Emp():
    def __init__(self,no,name,job,sal):
        self.no=no
        self.name=name
        self.job=job
        self.sal=sal
    def __str__(self):
        return f&apos;{self.no}-{self.name}-{self.job}-{self.sal}&apos;
def main():
    page=int(input(&apos;页码：&apos;))
    size=int(input(&apos;页面大小：&apos;))
    try:
        with con.cursor() as cursor: 元祖形式
            cursor.execute(&apos;select * from tb_emp limit (%s,%s)&apos;,((page-1)*size,size)) #显示从第几页看起，一页显示多少行
            for result in cursor.fetchall():  #返回元祖
                emp=Emp(*result)
                print(emp)
        with con.cursor(DictCursor) as cursor: 字典形式
            cursor.execute(&apos;select * from tb_emp limit (%s,%s)&apos;, ((page - 1) * size, size))
            for result in cursor.fetchall():  #返回字典
                emp=Emp(**result)
                print(emp)

    finally:
        con.close()
</code></pre><h2 id="8随机生成验证码并发送短信（用redis控制一个小时只能发送三次）"><a href="#8随机生成验证码并发送短信（用redis控制一个小时只能发送三次）" class="headerlink" title="8随机生成验证码并发送短信（用redis控制一个小时只能发送三次）"></a>8随机生成验证码并发送短信（用redis控制一个小时只能发送三次）</h2><pre><code>import io
import json
import time
import random
import requests
import redis

def gen_code(length=6):
    &quot;&quot;&quot;生成指定长度的验证码&quot;&quot;&quot;
    result = io.StringIO()
    for _ in range(length):
        result.write(str(random.randint(0, 9)))
    return result.getvalue()

def send_messag_example(tel, code):
   &quot;&quot;&quot;发送短信&quot;&quot;&quot;
    resp = requests.post(
        url=&apos;http://sms-api.luosimao.com/v1/send.json&apos;,
        auth=(&apos;api&apos;, &apos;e67b65751337d36224b26074ceb8a421&apos;),
        data={
            &apos;mobile&apos;: tel,
            &apos;message&apos;: f&apos;您的验证码为{code}。【铁壳测试】&apos;
            # &apos;message&apos;: f&apos;猜猜我是谁。【铁壳测试】&apos;
        },
        timeout=3,
        verify=False
    )
    return json.loads(resp.content)

def my_main():
    tel = input(&apos;请输入手机号:&apos;)
    cli = redis.StrictRedis(host=&apos;112.74.61.160&apos;, port=6379,
                            password=&apos;1qaz2wsx&apos;)
    if not cli.exists(tel):
        result = send_messag_example(tel, gen_code())
        print(result)
        if result[&apos;error&apos;] == 0:
            print(&apos;短信发送成功&apos;)
            cli.set(tel, 1, ex=3600)
    elif int(cli.get(tel)) &lt; 3:
        result = send_messag_example(tel, gen_code())
        print(result)
        if result[&apos;error&apos;] == 0:
            print(&apos;短信发送成功&apos;)
            cli.incr(tel)
    else:
        print(&apos;请不要频繁发送短信验证码（1小时只能发送3次）&apos;)

my_main()
</code></pre><h2 id="9-python中使用redis"><a href="#9-python中使用redis" class="headerlink" title="9 python中使用redis"></a>9 python中使用redis</h2><p>1.连接redis服务器<br>2.创建连接对象<br> cli=redis.StrictRedis(ip,端口,redis登陆密码)</p>
<pre><code>def main():
    cli = redis.StrictRedis(host=&apos;112.74.61.160&apos;, port=6379,
                        password=&apos;1qaz2wsx&apos;)
    try:
        if cli.ping():
            print(&apos;连接成功&apos;)
            print(cli.keys(&apos;*&apos;))
            print(cli.set(&apos;username&apos;, &apos;hellokitty&apos;))
            print(cli.expire(&apos;username&apos;, 120))
            print(cli.get(&apos;username&apos;))
            time.sleep(5)
            print(cli.ttl(&apos;username&apos;))
            cli.sadd(&apos;set1&apos;, &apos;100&apos;, &apos;200&apos;, &apos;100&apos;, &apos;200&apos;, &apos;500&apos;)
            print(cli.scard(&apos;set1&apos;))

    except:
        print(&apos;连接出错&apos;)
    finally:  #可能有错
        cli.shutdown(save=True)
</code></pre><h2 id="10redis和mysql结合提高程序效率示例"><a href="#10redis和mysql结合提高程序效率示例" class="headerlink" title="10redis和mysql结合提高程序效率示例"></a>10redis和mysql结合提高程序效率示例</h2><p>序列化 - 把对象转换成字符或字节序列 - 串行化/腌咸菜<br>反序列化 - 把字符或者字节序列还原成对象 - 反串行化<br>python中要实现对象的序列化和反序列化有三种方案：<br>-json - load/loads / dump/dumps - 字符序列<br>-pickle - load / loads /dump/dumps - 字节序列（使用教多）<br>提高效率原理：redis将数据存放在内存中，mysql存放在硬盘中，从运存中提取数据效率远远高于从硬盘中提取；<br>取数据时，先用redis去内存中查找是否存在数据，如若存在就直接提取，不存在，就利用mysql从数据库提取；<br>最后在利用redis将数据存入内存中，从而方便下次查找，提高效率；<br>可以将常用数据存入redis这样能大大提高效率；<br>例如选择每个省及其下的县市时，省为常用数据，故常将省存在内存中</p>
<pre><code>import pickle
import time
import pymysql
import redis

class District:
&quot;&quot;行政区域&quot;&quot;&quot;
    def __init__(self,distid,name):
        self.distid=distid
        self.name=name
    def __str__(self): #打印函数
        return self.name
    def __repr__(self): # 查看函数
        return self.name

def my_dis():
    # 记录程序执行起始时间
    begin=time.time()
    cli=redis.StrictRedis(host=&apos;120.77.222.217&apos;,
                          port=6379,password=&apos;1qaz2wsx&apos;)
    # 优先从缓存中读取数据，如果缓存没有所需数据，才连接数据库进行查询
    if cli.exists(&apos;provinces&apos;):
        provinces=pickle.loads(cli.get(&apos;provinces&apos;))
        # 直接从缓存中通过键获取数据并反序列化成Python中的对象
    else:
        provinces=[]
        con=pymysql.connect(host=&apos;localhost&apos;, port=3306,
                          database=&apos;hhrs&apos;, charset=&apos;utf8&apos;,
                          user=&apos;root&apos;, password=&apos;123456&apos;)
        try:
            with con.cursor() as cursor:
                # 从数据库中查询省级行政区域
                cursor.execute(&apos;select `distid`,`name` from `tb_district` where `pid` is null&apos;)
                # 将查询结果放入列表容器
                for dist_tuple in cursor.fetchall():
                    # 将元祖数据解包生成对象
                    dist=District(*dist_tuple)
                    # 将对象添到列表
                    provinces.append(dist)
                # 将列表序列化（pickle）然后放入redis中缓存
                cli.set(&apos;provinces&apos;,pickle.dumps(provinces))

        finally:
            con.close()
    # 记录程序执行结束时间
    end=time.time()
    print(f&apos;执行时间：{end-begin}秒&apos;)
    print(provinces)
</code></pre>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/12/30/redis数据库主要语法-及与mysql结合用法示例/">
    <time datetime="2018-12-30T11:01:25.000Z" class="entry-date">
        2018-12-30
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-hello-world" class="post-hello-world post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2018/12/20/hello-world/">Hello World</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2018/12/20/hello-world/" data-id="cjqj8h4x20001bwurskbmz6r8" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/12/20/hello-world/">
    <time datetime="2018-12-20T11:12:25.367Z" class="entry-date">
        2018-12-20
    </time>
</a>
    
    
    </footer>
</article>






  
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s">
        <input type="submit" id="searchsubmit" value="搜索">
    </div>
</form></aside>
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2019/01/04/模型设计/">模型设计</a>
          </li>
        
          <li>
            <a href="/2019/01/03/模型关系映射/">模型关系映射</a>
          </li>
        
          <li>
            <a href="/2019/01/02/django环境搭建/">django环境搭建</a>
          </li>
        
          <li>
            <a href="/2018/12/30/redis数据库主要语法-及与mysql结合用法示例/">redis数据库主要语法-及与mysql结合用法示例</a>
          </li>
        
          <li>
            <a href="/2018/12/20/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    <aside class="widget">
    <h3 class="widget-title">关于我</h3>
    <div class="widget-content">
      <p>邮箱：huyifi@163.com</p>
      <p>QQ：1838267371</p>
      
    </div>
</aside>
  
    
  <aside class="widget">
    <h3 class="widget-title">Archives</h3>
    <div class="widget-content">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </aside>

  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Music</h3>
    <div class="widget-content">
      <audio src="https://img.hacpai.com/file/2018/11/karera_wo_tame_no_koushinnkyoku-95a27a16.mp3" controls="controls" style="width:100%">
        您的浏览器不支持 audio 标签。
      </audio>
    </div>
  </aside>

  
    <script>
    // sub title
    var subtitleList = [
        "『不懂形式语言就是不懂语言。』——沃·兹基硕德",
        "『涉及到物理实体的项目，必须要仔细论证。』——沃·兹基硕德",
        "『你有无知的权利，也有发表看法的权利，但是没有「无知 && 发表看法」的权利。』——沃·兹基硕德",
        "『韮之大者，高位接盘！』——沃·兹基硕德",
        "『卑鄙是卑鄙者的通行证，高尚是高尚者的墓志铭。』——北岛",
        "『邪人用正法亦邪，正人用邪法亦正。』——谚语",
        "『坦白从宽牢底坐穿，抗拒从严回家过年。』——谚语",
        "『Stay young. Stay simple. Always naive!』——谚语",
        "『3D 打印领域急需一场开源运动。』——沃·兹基硕德",
        "『你们媒体千万要记着，不要「见得风，是得雨」。接到消息，你们媒体本身也要判断。』——长者",
        "『假设这些完全无中生有的东西，你再帮他说一遍，你等于......你也有责任吧？』——长者",
        "『刚才你问我啊，我可以回答你一句「无可奉告」。』——长者",
        "『我告诉你们我是身经百战了，见得多了！』——长者",
        "『美国的华莱士，比你们不知要高到哪里去了，我跟他谈笑风生。』——长者",
        "『我有这个必要告诉你们一点，人生的经验。』——长者",
        "『我没有说要钦定，没有任何这个意思。』——长者",
        "『你们啊，不要想喜欢弄个大新闻，说现在已经钦定了，就把我批判一番。』——长者",
        "『一个人的命运啊，当然要靠自我奋斗，但是也要考虑历史的进程。』——长者",
        "『我说另请高明吧，我实在也不是谦虚。』——长者",
        "『苟利国家生死以，岂因祸福避趋之。』——林则徐《赴戍登程口占示家人二首》",
        "『敢同恶鬼争高下，不向霸王让寸分。』——毛泽东《七律·庆祝第二次核试验成功》",
        "『我生不为逐鹿来，都门懒筑黄金台。状元百官都如狗，总是刀下觳觫材。』——张献忠《七杀诗》",
        "『一泓海水杯中泻，更变千年如走马。』——李贺《梦天》",
    ];
    
    document.addEventListener('DOMContentLoaded', evt => {
        var i = Math.floor(Math.random() * subtitleList.length);
        document.querySelector('#subtitle').innerText = subtitleList[i];
    });

    //Kill XP and IE8
    (function(){
        var ua = navigator.userAgent;
        var res = /Windows NT (\d+\.\d+)/.exec(ua);
        var xpOrLower = res && JSON.parse(res[1]) < 6;
        res = /MSIE (\d+\.\d+)/.exec(ua);
        var ie8OrLower = res && JSON.parse(res[1]) < 9;
        if(xpOrLower || ie8OrLower) {
            alert('请不要用XP及之前的Windows系统，和IE8及之前的IE浏览器访问本站！');
            location.href = "about:blank";
        }
        var fromBaiduSE = /^https?:\/\/www.baidu.com/.test(document.referrer);
        if(fromBaiduSE) {
            alert('检测到你还在使用百度搜索，作为一个程序员，这是一种自暴自弃！\n\n做不作恶的程序员，从不用百度开始！');
            location.href = "about:blank";
        }
    })();
</script>
  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2019 hyf</p>
    <p>All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>